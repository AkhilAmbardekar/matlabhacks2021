function [Y,Xf,Af] = NNPSO(X,~,~)
%NNPSO neural network simulation function.
%
% Auto-generated by MATLAB, 24-Jul-2021 21:17:05.
% 
% [Y] = NNPSO(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 23xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [201.3;22640;827;3.2;0;22.3;0.0221;23.1;0;0;0;7.5;0.4;22.3;13.5;11.2;2.6;10.1991551;0;0;0;22.99248989;0];
x1_step1.gain = [0.00198886237072395;1.94184183698238e-05;1.96667179640227e-07;0.0452488687782805;0.000204869565223733;0.00332391557254446;0.506598444742775;0.0404858299595142;0.031201248049922;0.0275862068965517;0.0386100386100386;0.0422832980972516;0.0689655172413793;0.0285714285714286;0.034965034965035;0.0371057513914657;0.0454545454545455;0.0222715053764489;0.0232699386493117;0.0469269592817454;0.0476982591868275;0.0363089043608126;0.0937815126250593];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.014571193813855866026;0.11968116638602040169;-0.017155645047904725942;-0.16404927051995457643;-0.29834900639739003747;-0.20576788665118733723;0.14604181348100633842;-0.19868791403405161589;0.0092390101870654054578;0.083448519251237598948;-0.30966382068153164298;-0.18841908681568722561;0.14613290242572404831;-0.21765854547531496288;0.12754969886335523754;0.10565761683625864154;-0.14805821455966280964;-0.044977184047996325578;-0.32578038141595516697;-0.021543667501360531935];
IW1_1 = [0.27907676666651282105 0.058226122888980429149 0.19595094349982716819 -0.28012658155575792529 0.027530961882010325514 -0.14155744388865712513 0.2058271157426588005 0.23952921547400932156 -0.13129451116284307499 -0.13962540379412807789 -0.036835565508413381508 0.3285162664283040046 0.25661391692762169914 -0.10199418240600127694 -0.13328553482200580782 -0.13103891607166368027 -0.33875698600813447525 0.018525232189690415269 0.143416257075492104 0.13085045302614922713 -0.091803044211857240398 0.17667797042356822579 0.13959681044978172748;-0.35003745444927936159 -0.087985422504109192521 0.065750700939084069652 0.27809153267233660545 0.12652624475573193141 0.076960209617355626599 -0.19024199945910263976 -0.081757882590795333266 -0.27660085388159899589 0.19448264682160401606 -0.030578277563625626267 -0.085814798630405406121 0.23838978178779293704 0.020083377546848042022 -0.19019359466803362202 -0.15102073486516207068 -0.16026485586255451166 -0.019543083971383566622 0.086595726436762374134 0.021263231741028065791 0.14993233328732813447 -0.095572037145187513363 0.1104183359670534853;-0.15792441267585768938 -0.0019738096216739553501 0.023716122168328513525 -0.049318820576036363768 -0.030062495625042234826 0.04510462163454236062 0.091252780624845486468 -0.10489182348222064745 0.33503601252701475932 0.13718773862376565376 -0.037585412013568859912 -0.3111145777698697823 -0.046399184450148504844 -0.48973315107592862994 0.063924848237554302011 0.34932043600369294678 -0.16372907969229311131 -0.10009087740120692356 -0.095785337544717366609 0.066516794091993763915 -0.11763674564662240929 -0.20698045340153226057 0.3090695573785081085;0.035125177972468647758 -0.13380729883067091213 0.30423122031328408976 -0.040616105410403315068 -0.0062942146562822154365 -0.12458525497006181504 -0.13896111349512391131 0.17044272376505789635 0.17806247886749895781 -0.15935999269529133038 0.22304626891671550104 -0.59482142670241244797 -0.5460650515539804406 0.15113963706369321072 -0.10982941533213297358 0.17483066870343652588 -0.13814076667310026814 -0.1995452181488356902 0.074624765950818808258 0.040538360004271058179 0.051920479123053864257 0.18373768252586528127 -0.22663263370245945172;-0.18248448404783959576 -0.29465673739957976007 0.23490764189995277933 -0.26033345652478756538 0.19946666047902844587 0.15586791347566908428 -0.0055152150232786762568 -0.029503725072240489374 -0.17782888748034891835 0.23721832799051936758 0.041092671058131788331 0.24721528386943403266 -0.22257052067833396625 -0.46452552663902740848 -0.57019626003306778106 -0.11758873763123038614 -0.49557364591479136084 -0.014342944093423310586 0.27151110523967209032 -0.085771099361103692038 0.15734241664325665511 -0.089584156553688717994 0.27796776285123642181;-0.083390719676734240129 -0.058828638869301300152 0.24785432886728531177 0.0059377080797441746801 0.065273230510449489761 -0.085909964107676595191 -0.023786109569324819651 0.28578930593357204648 -0.14492754284807909948 0.048037502324779129959 -0.0068674527244385330516 0.2658299477972748126 0.46680446367828659637 0.035708837519044654696 -0.0066032656620563590436 0.082600175705247497193 0.37312548224141528497 -0.064397820345356113214 -0.046707438488065029791 -0.21426597796599852752 0.10233516013655322152 -0.070511095569329010346 -0.008157474021229835226;0.37536883587406111307 -0.44046325980073708362 -0.32660059172877548006 -0.24746215773964813645 -0.093102654530073256089 0.58263566780836373304 0.11433279336402445148 0.28657719329050945767 -0.14690579630809535994 0.07488838285901486258 0.096909458723535735203 0.058540171937671643676 0.086208524920573931238 -0.092561628573073206905 0.25740557772765654265 -0.21972344216540334871 -0.15199827934812035202 0.10005028558453944731 -0.0038139701067612815331 -0.0074934410357256672069 0.20253451552161502724 -0.17207228893300180461 -0.34667113793215215134;0.14075120506651372931 0.14313495969907691352 -0.056539038000383637361 0.17440691544723976869 0.11067395761584701563 -0.12739432830337066305 -0.0056740395022129522934 0.34423475749883497565 -0.059022907276651249975 -0.14101014663094657564 -0.21789076890556136057 0.14980786901830156488 -0.1769975456955345805 0.20670526540544970073 0.48843892877443917389 0.35647171359836959947 -0.20617874230742730401 -0.30398112281362171805 0.020964465430898207576 -0.038740074541866717506 0.21989678079161631419 -0.26595277788599924751 -0.11431041557616292148;0.057300817534825278232 -0.025043913907908565281 0.059003991416344464538 -0.20895220436273564957 -0.17162267622312690762 0.12405530105655682149 0.16885521397357380891 0.11418291657046925058 -0.086658574854543424237 0.14919515032120037046 -0.011807636334305008849 0.18414936902567916044 0.26914754624015047035 0.37107533277990450982 -0.51529394737858280617 -0.67753948336334957059 0.050460494807934359873 0.16126354286284688699 0.13232239285218905245 0.11513925447953506087 0.11780486821772512274 -0.11851861378154569804 0.032741733764144437258;0.08496642182720400005 -0.085493025301352013057 -0.0089377476725180909217 -0.25461931130721593419 0.18000532918733533339 0.23605721942742191599 -0.02886093600465372902 0.055944610718142877281 0.020668657111714373864 0.027781095888776551062 0.039483418426791545841 0.089029345970658410603 0.32907598033320223374 0.29652793490051176928 0.085194171874197144323 -0.057028517267604120211 -0.38462269686105005073 -0.44225587057454074369 -0.010294907379067828185 -0.067563142244742468989 -0.044669220754943020357 -0.46241014685868825351 0.43945675472981560183;-0.11527915211050940303 0.032361649253818874916 -0.069184140424560724991 -0.070846201525738963789 0.03586936397417909983 0.38347215030782616507 0.24274543676366661105 0.024032736340377735401 0.33438024141605354744 0.075346169691644634958 0.096069232003005447518 -0.43339348961180623743 -0.35056522035503717705 -0.3759008892038029348 -0.65463275684994681747 -0.25086439867626258993 -0.35861957356338286518 0.25687393486906184847 -0.19886286725649074403 0.44052518301037585369 -0.12999987459173448223 -0.22600814345789527193 0.21854295351353641985;0.26349544572616323546 -0.13665866693317332836 0.16333954721141200062 -0.25261286877235195059 -0.15430126940116728473 -0.0034359629809091215939 0.041879364492490418759 -0.13442775457874839296 0.24065659927321189637 0.038283404778759175247 0.2742718310802977344 -0.74659693549366368259 -0.071973241475223201369 0.24103544559449033291 0.110029202241292548 -0.18371886984454624536 0.16181015017556521496 0.058697267694966873131 0.095191355377957184714 0.24601905588607528297 0.0084814563671580141258 0.081758750396984811171 -0.20281137660452339122;-0.014885360721539250481 0.45571375201529001897 -0.057269880104253975683 0.12178773690207740643 0.051354841128641949555 0.060377082197840561961 -0.17203636870607119658 -0.27661668676131601075 -0.2045115729588682929 0.071745055629338527758 -0.31333208351598990093 -0.26067913154056104874 0.030783031857785268792 0.34420495513701993007 -0.12358286348452106329 -0.075703569046469285087 0.2222848129234597514 0.23154540241535609413 -0.11065767366111615988 0.14056760482279659352 0.1505031123723784281 -0.25686235190489636881 -0.035408777718474913898;-0.16053002121697418358 -0.20761123163013520121 -0.1362484712757697225 0.0064073429533449471548 -0.032586688417413300911 -0.099153107952510893819 -0.020123472673861310389 0.25534563001553312045 -0.049412759838394680612 -0.090623300044954877008 -0.18617871299689220388 0.33592584220455196098 -0.096269922761094348096 -0.40331660094303178887 0.12126139409607060438 0.24750635908862744783 -0.17187624638812495914 0.089879115673835899281 0.31061751189261949113 0.17418496641886227483 0.029934271646407866613 0.066937968983287743363 0.092843092177464919823;-0.020836450017852253813 -0.13005948330809061209 0.013507359025874177832 0.31361867997347037118 -0.20238366204822044736 -0.025960536291484696825 -0.0018643634820459079222 0.10662353494907562956 0.033037952344550446104 -0.045954400850107303411 -0.0043782531100890146464 -0.36763753448939545665 -0.36614512921497804898 -0.34235266547426673744 0.34075868691643151909 0.46614206569482508069 -0.12183881862171207222 0.12449003192682128738 -0.13436909283716819141 -0.030903869274007986917 0.35215070626889538596 0.045001485623129076907 -0.50531159716850770902;-0.32563588378398861112 0.01463181637668273076 0.29389898397429703447 -0.1252194650244136398 -0.0092677341255259417657 -0.057431589773337198002 0.049156749228488151593 -0.068307816374819363414 -0.27606922666424987822 -0.040243762370398672434 0.029773155416270163237 0.24474617144645241518 -0.049994670486763773121 -0.69343786288869058154 0.57372709382843811721 0.36954454202079600744 -0.25260672082922502879 0.15952718984938210611 0.17523816521292681636 0.1630516605856147383 -0.073228774400252147347 0.20897295728112830204 0.0053683944803139425558;0.094565035807443784122 0.14830787130248676564 0.055150596407535869281 0.13863211770963776437 0.087606998993916676555 -0.11352975085262903554 -0.17047132049591087744 0.40900342719024873617 -0.13376176022365968143 -0.20861984393046983932 -0.51741395835491821309 0.11979940741302211316 0.20128342864118273225 0.24713317643418103442 -0.12000095064900198616 -0.228948083175144812 0.38312613688417129776 0.21422136134542937858 -0.039920489121084846984 0.16728474149394761961 0.015252559022310452699 -0.013060255668836874554 0.1457639624993350147;0.33554664873996964403 0.10130878335690995939 0.11187948158177786484 0.039725504228698950426 0.32515078014805881557 -0.1516403044848471382 -0.07384093111736533821 0.015970009387895972575 -0.17000632130536139086 -0.13466934549302614355 -0.066546370717700351061 0.28759758966955489834 -0.036900727101319689971 0.59038121732625259419 0.054055414103350560295 -0.15095570069985497774 0.33702150266233987796 0.014855924930015423566 0.057959834823289202443 -0.53522718625715504093 0.10390092873569961585 0.076473425066324526855 -0.1890433874661378022;-0.092924270571702285992 0.15189372584235510955 0.14907405933384437757 0.11769136298360692583 0.14985920818474754435 0.2202265838754698668 0.041027502166087463642 0.21805623208761218401 0.25279078470589405603 -0.032769630549112770124 0.12483454308636761365 -0.33761558408293307343 -0.72857339069972437695 0.03607194483493317283 -0.79809395028138085948 -0.46693300569894635732 -0.22041304764245883696 0.10143261740170711471 -0.16502808263849097492 0.30260823260858527028 -0.14517542902120603165 -0.20643227588173315712 0.055319911836143771666;-0.21521394688733400113 -0.11615399540856111149 0.010997170828820179711 -0.056005148366913309887 -0.071422713302377177635 -0.012347234270210566062 -0.15361031752068263212 -0.22132028859978508661 0.22699228096911774899 -0.14809814715548066943 0.11811525824309050681 -0.27716303084914289956 -0.33614932733568914092 0.47145216572130060895 -0.42312463450943693655 0.048005948646325423412 0.056949010137641781215 -0.11360708000453016708 0.039831813491161750795 0.13687152732385235443 -0.038019431249105319071 0.33081117355644074074 0.23416904821350276178];

% Layer 2
b2 = -0.081200583822220256947;
LW2_1 = [-0.79593938860131130397 0.71178715316417373593 1.0330686781362508064 -0.89784616328329769352 -0.87564748426073812926 -0.66994025277328483892 0.8172025797842699113 0.83776450638358423983 0.7995010217117903828 -0.8079770149057250439 -1.0093941850489347445 0.91119132345183961874 -0.68934355907481403847 -0.85255044259626833192 -0.95621080401691394002 0.89330715613858868718 0.57714713404402440133 0.67060399850122609511 0.95449119287517458776 0.79096254950101374526];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0316455696202532;
y1_step1.xoffset = 15.7;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = elliotsig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Elliot Sigmoid Transfer Function
function a = elliotsig_apply(n,~)
  a = n ./ (1 + abs(n));
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
