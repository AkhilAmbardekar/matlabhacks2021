function [Y,Xf,Af] = NNPSO(X,~,~)
%NNPSO neural network simulation function.
%
% Auto-generated by MATLAB, 24-Jul-2021 21:58:09.
% 
% [Y] = NNPSO(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 23xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [201.3;22640;827;3.2;0;22.3;0.0221;23.1;0;0;0;7.5;0.4;22.3;13.5;11.2;2.6;10.1991551;0;0;0;22.99248989;0];
x1_step1.gain = [0.00198886237072395;1.94184183698238e-05;1.96667179640227e-07;0.0452488687782805;0.000204869565223733;0.00332391557254446;0.506598444742775;0.0404858299595142;0.031201248049922;0.0275862068965517;0.0386100386100386;0.0422832980972516;0.0689655172413793;0.0285714285714286;0.034965034965035;0.0371057513914657;0.0454545454545455;0.0222715053764489;0.0232699386493117;0.0469269592817454;0.0476982591868275;0.0363089043608126;0.0937815126250593];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.047517075512730683196;-0.18740891254528740939;-0.045120729293195147025;-0.16847435313642833421;-0.16101694470612781807;-0.13150944916586171374;-0.020696241627205836516;0.10099364119560967634;0.20822296739548332156;0.16427554840108360423;0.032841707496123029308;0.12035628010104351682;0.47565014991779974718;-0.13945276427176220291;0.020053260108507206527;0.35205419568686768805;-0.15520184852392865382;-0.11357733814367193537;-0.12343838815237982709;-0.21913531642997940985];
IW1_1 = [-0.30863260066455128205 -0.10252338682007097748 0.26518994487712016506 -0.21129008037777710638 0.15444211571010624251 -0.066195914791295648594 0.030548376047698534708 0.28800822331150360833 0.34302623598798076543 -0.2029767342033320654 0.14778776932467060923 -0.052571678520517022004 -0.24935761113334678485 -0.29601989511775644859 -0.018476630900998179674 0.33911070473840598805 -0.1671066811269100727 0.26082104594608684911 0.11583083551211628692 0.15227331516993491967 -0.22887288507274117233 0.048630172791097575624 0.098020996427007525686;-0.30451418468167440468 0.05964869622067962146 0.041274625381552250414 0.033394026970385411179 0.069441056823113744834 0.033393182646321635521 -0.22483155873877938569 -0.047943883851164069421 0.32981861525754690989 0.042663226099097957544 -0.11242940417924479624 0.095445674585968448556 0.12891319336374884585 -0.086713705569979093735 -0.43542389325233643582 0.080871442721454120384 -0.065228942728972214016 -0.13024592690208616763 0.12566166471409792593 -0.083252465903932190705 -0.047228260854725881424 0.055444391721538775764 0.033454547793466862804;-0.23603079041652663683 -0.13223055706530711939 -0.051911514114606982506 0.1025216172633746925 -0.13204194228747639928 -0.19625781391353691596 0.21744441486667875907 -0.26891146470149768222 0.20475140967246827084 0.10260598706588053286 0.092210722889001575653 0.0051244963813948827755 0.054327732301582436214 -0.25682998741856616354 -0.13679185588723749567 0.47879164903903748129 -0.40314326574412306936 -0.11652228676398333762 -0.019738565724284173886 0.20751782971350840601 0.064547519104233661014 0.14039774016607448059 0.0064621860789515804882;-0.099894143651440642229 0.045923767351302650919 0.12738295158499859938 0.28240256663852902896 0.094016625325437072624 0.034556300997649579132 -0.26689536170196626053 -0.0391837298651753832 0.008801736642706416841 0.078035380324427514043 -0.74324907195060485599 0.044447567365599523204 0.018611568698871323868 0.14256845112087024319 -0.063856326612678177002 0.19087759147931385173 0.11713460030087334551 0.14183176862304397448 0.024712214775672591838 0.22588088257310143248 -0.045602790525176996328 0.38274853130269703705 -0.16568120343980191622;0.14432869911803250518 -0.074588275067391657247 0.00027250212951414803713 0.16578970764252404235 -0.020125890441884862481 0.20176178695049040712 -0.27031045125888186753 -0.13196128416086752577 -0.24690533704585776453 0.0022413955900925887008 -0.065338135824820148256 -0.29643119887508667665 0.039914188034526482118 0.43973256746414607354 -0.31408996808901312736 0.026661002436516183928 0.065276601850416143824 0.0037623105850956256417 -0.061174610456523281776 -0.29457363393601498913 0.19655531182750837771 -0.16641875948624007542 -0.061720861695315196171;-0.2293084493810368385 -0.028045138424016291534 0.034492264121183342784 0.18795828231783356932 -0.13926520359192742782 0.023145283294631020105 0.35874487878291272391 -0.15752020977215130948 0.083163943314211286051 0.14470481659994111068 0.09244841252492684569 0.14726313065490520549 -0.20825654995444342621 0.22461113157489454029 -0.5266092319494780627 0.11793653406908181924 0.20443145278496729911 -0.10339516310523655385 -0.13287409231379326835 0.083421196053142659954 0.050391704789389112074 0.10780493029438417696 0.06124558011729233642;0.060943838567335276157 0.208225814894321265 -0.068759082196736390213 -0.26293346955655061414 0.014681288104055315383 0.069952188723316641172 0.068266977248817042878 0.17039945200737913189 0.19476820870078065395 0.30324425586184500236 -0.39859507864699167401 -0.05566083261657345238 0.061372723260160369496 -0.25139779265274686537 0.25366273433606884025 0.73048024836304359386 -0.1698346675710769027 0.13175172006938370983 0.19979416158565968531 -0.014771769161386073474 0.15375719379173108381 -0.10573276807117089338 -0.041843912264345195506;0.0024583903158031310092 -0.24473008055169959141 -0.05610325152227788742 -0.062237624672353664135 -0.14758713120280367304 -0.081447273875385570174 -0.20713100262134587215 -0.34279845564258359936 0.068415634260612090412 -0.13236783003926988478 -0.088561036636189957583 0.042708242318104196189 0.20037125804518993166 0.00035992038128112387087 0.11989580190804136062 -0.53308857000166520734 -0.29286682232084337851 -0.38207901577253211567 0.069108990686434945694 -0.061272056745946268386 -0.19037953375972677117 -0.078225676994087250948 -0.0032852179936826639284;-0.0042702968720808795466 0.057489289698260712114 0.25230510378596682219 0.13230212333321217377 0.21810304720368431375 0.14138744124428492821 0.11501212080041313401 -0.4001397742827101367 -0.28154925390776047722 -0.0078589235286205313263 0.047404817917537686589 -0.072780275683960130029 0.13662751716772181254 0.23550650173423862133 0.025866495962494729516 -0.32118868971990427452 -0.27103070061722117634 -0.081314838944082423744 0.026414376891683591375 -0.32675180184210428358 -0.099573858424591890626 0.15182452770641777229 -0.11640341339528194331;0.068775675903596358851 -0.26747690652282718471 0.024770205587449477952 0.19336726066453133188 0.15854785618607408759 -0.018395437753069707881 -0.033897726101446430669 0.054972045839825491031 -0.24883262049387402937 0.1409120149574314973 0.23550827308955715744 -0.24511684415356918554 0.14960415585457431664 -0.081504958293064366792 -0.12434681025470092908 0.13493608277969548759 -0.054672874121117320811 0.054411376867769513377 0.1792215935865869858 -0.17127085105309450275 0.031890481222501869396 -0.047086472353016356474 0.15851351045245209992;0.12012855487658130604 -0.24254086546871142516 -0.3668972157648713317 -0.054511210656491636273 -0.16593457354488333477 0.072995348309777025042 -0.092527190471001857786 -0.25449647179371737149 -0.24966790969642596587 0.011591121038115159703 0.31497673544429399817 -0.09592281330749266588 0.30550973007866960574 -0.40552971394535347605 0.34154990724084299814 -0.049378106616196973389 -0.2745464160768979478 -0.18118366033170521523 -0.063065008514253936833 -0.083083463889528932911 0.20788064450597090738 0.099117441517722698618 -0.058327590886754689115;0.36196834927275745031 0.12241363679479541626 -0.03987989656789563131 -0.0606905548697604727 -0.053323022266391094381 -0.024982484982419995295 0.0064839988209361874502 0.11084927809354021278 -0.25831988501332425745 -0.11143254191568595368 -0.12393252493358943023 -0.40739437170462788895 -0.35448518938086709396 -0.28617682605832023279 0.32316883285083558563 0.60248167980805966693 -0.104860502613415979 0.29902137670559192362 -0.15745426815652480146 0.077892943074276896342 0.28138014043709025369 0.053921699267827701008 -0.25150156799875617031;-0.035501740054124625301 -0.21145689979602858011 -0.096195416340349282347 0.098781651281422661048 -0.1233088303573322414 -0.27647964676327191347 0.050542146924564795851 -0.058550123689166587437 0.082783567668139310114 0.016526678371322444522 -0.014675894429694769441 0.2188124109190510147 0.22214717193601571377 -0.50698138100729017719 0.59549331777809155763 0.4890542574198916137 -0.36012249233251519831 -0.25739588493430953786 0.31643401557569511562 0.097104318898661515225 -0.068097196963926909241 0.22348301664057540483 -0.055783244315462235385;0.020160261805390582851 -0.018137780367435945433 0.03616899611298102224 -0.29239757248746883755 -0.094261334039607735935 0.22902405158390484741 -0.28842018474399960803 -0.13958303349842871022 0.0095331110549466552273 0.041021758955617430853 -0.16151742350442183094 -0.49901827663282866121 -0.19255820544691246154 0.027225314431489167771 -0.17479126221948212971 -0.11081527954287358206 0.16842073990176614773 0.17051270369787094316 -0.31550258433962247162 -0.111414964491686308 0.12836909579543395732 0.021047002195313635475 -0.32237229853971421933;-0.067910607053354526963 0.11188798417053617829 0.039014439243203816177 0.056414479703762142326 0.084298209418512154434 -0.05600254784910915079 0.41737965638571405957 0.24130201427670075476 -0.018406342902152997287 0.045161546433777774445 0.46870655996251675557 0.19619257093764641553 0.015622634247567539212 -0.1435842765072629923 0.051201769870805255436 -0.062417253279493614682 0.24780882413217517057 0.0076305551162907823623 -0.055782413304731624792 -0.30700559603812921372 -0.40165428052173385298 0.068455554167855980907 0.22549412151769809842;-0.071442305076561962718 0.1421584935811973649 -0.064260114431192200124 0.19516104435459102895 -0.1620836452661686411 -0.20093585130161781271 -0.20642259870589491078 -0.09516061120980040533 0.14484214829257135992 0.18507291304898021433 -0.21111916944140446395 0.26912086033195481427 0.26966459417687099753 0.39967885162524474651 0.42520050003830822671 0.15104726316573605094 0.57018098376082193557 -0.056613587278481376786 0.1522247175511049766 -0.25430322962674795084 0.0016904195338972344449 0.15004614371592570055 -0.29608615525691289738;-0.013213847298573732497 -0.17264752262451391052 0.099837666671140440355 -0.1424980518730706025 -0.15059519404103000051 0.56204644292453831422 0.22095621564354225863 -0.1884248607966619582 -0.20387064428160486806 0.37282038298466102511 0.0050202185718323929717 0.11767116300033192422 0.039559044999449295699 -0.063817980773164958985 -0.082647877846837927707 -0.37103098582777249703 -0.20017006517317081915 -0.33371103526356510338 0.012483976100295923403 -0.13689591061567712993 0.10608563926550523826 -0.26550235579282832621 0.079401221953185080471;0.0080885331363710188252 -0.0069567186638235896032 0.15076490035102746434 0.30355659257054667943 0.028575076746218810303 -0.19079669118003789174 -0.23262030383827847491 0.45193487903898738045 0.061140166572089878205 -0.12080566477560156224 -0.5169151868985353282 0.083133819800837449598 0.048050040134951024773 0.46664911141704706887 -0.098252238911917172404 -0.083445456101439427488 0.58806727158175786663 0.26142885627559864226 0.086214476484908098008 0.35519098068356463882 -0.096366645756587238081 0.042327115128432242497 0.010004982619426901203;0.025391035221560571272 -0.21143559902913802717 0.090427071160567001895 -0.17975535273127679625 -0.044003773555896741332 0.10903243669620141243 0.3238096166676153187 -0.099662957250242906193 -0.19313586396108517462 0.053109732166149177524 0.28585044769431733336 -0.053010027230215119032 0.10148353502137014148 0.15353670563678514793 0.22421676543983579122 -0.37792128713385853001 0.038349982935417067931 -0.12266992688954408974 0.12975197815332736861 0.0033804514118655109092 0.04438506872903794781 -0.069480967733918139184 0.04659129032112871438;0.016425352771224057541 0.1973452485843034121 -0.16850588300725938273 0.49812681446071360725 -0.026892323491213610681 0.050476700307543059809 0.099745692149817682948 0.0033815263043940873428 0.007494583688676828212 0.0086646939603048766382 -0.15495154070690161929 0.31727675425778484319 -0.30320752779706411362 0.20034544178675187109 0.22942450562945673753 0.28590981889249356129 -0.1079088071511439817 -0.22251679244177646755 -0.099384752045700575085 0.12833092432623349755 -0.10413569873958486434 0.2473395644805767013 0.12886305211742429822];

% Layer 2
b2 = -0.11538566837488940797;
LW2_1 = [0.58900711042374087612 -0.7573470262683718035 -0.73733542898370429963 -0.77573752293095399324 -0.71971703989601487628 0.79382114875457832071 0.76351166141555715239 0.62078414919170765707 0.72813405232544092804 0.51066202695755225083 0.75420479027144371464 -0.83903999207057777809 -1.0461881622339526121 0.85152498840275614445 -0.71394172974602809756 0.96409309340296378554 -0.69142297928861440326 0.84118529861573954065 0.81181375303539682342 0.83779056583603173092];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0316455696202532;
y1_step1.xoffset = 15.7;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = elliotsig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Elliot Sigmoid Transfer Function
function a = elliotsig_apply(n,~)
  a = n ./ (1 + abs(n));
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
